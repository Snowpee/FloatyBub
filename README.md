# Floaty Bub ğŸ«§

[ä¸­æ–‡](#ä¸­æ–‡) | [English](#english)

<a name="ä¸­æ–‡"></a>

ä¸€ä¸ªåŸºäº React + TypeScript + Capacitor çš„ç°ä»£åŒ–æ™ºèƒ½å¯¹è¯åŠ©æ‰‹åº”ç”¨ï¼Œé›†æˆäº†å¤šè§’è‰²å¯¹è¯ã€çŸ¥è¯†åº“ç®¡ç†ã€è¯­éŸ³äº¤äº’ã€æ•°æ®åŒæ­¥ç­‰ä¸°å¯ŒåŠŸèƒ½ã€‚æ”¯æŒ Web ç«¯åŠ iOS ç§»åŠ¨ç«¯åŸç”Ÿä½“éªŒã€‚

> ä½¿ç”¨ [TRAE SOLO](https://trae.ai) å¼€å‘
>
> [æŸ¥çœ‹ Web Demo](https://floatybub.vercel.app/)

## âœ¨ åŠŸèƒ½ç‰¹æ€§

### ğŸ¯ æ ¸å¿ƒåŠŸèƒ½
- **å¤šæ¨¡å‹æ”¯æŒ**: æ”¯æŒ Kimiã€Moonshotã€OpenAIã€Claudeã€Gemini ç­‰ä¸»æµå¤§è¯­è¨€æ¨¡å‹
- **æµå¼å“åº”**: å®æ—¶æ˜¾ç¤º AI å›å¤ï¼Œæ”¯æŒæµå¼æ–‡æœ¬å’Œå›¾ç‰‡ç”Ÿæˆ
- **æ™ºèƒ½è§’è‰²ç³»ç»Ÿ**: æ”¯æŒè‡ªå®šä¹‰ AI è§’è‰²ã€ç³»ç»Ÿæç¤ºè¯å’Œä¸ªæ€§åŒ–å¼€åœºç™½
- **æŠ€èƒ½ç³»ç»Ÿ (Agent Skills)**: ä¸ºè§’è‰²/ä¼šè¯æŒ‚è½½æŠ€èƒ½è¯´æ˜ä¸é™„å¸¦æ–‡ä»¶ï¼Œæ”¯æŒä¼šè¯å†…å¯ç”¨å¹¶æŒä¹…åŒ–
- **çŸ¥è¯†åº“ç®¡ç†**: å®Œæ•´çš„çŸ¥è¯†åº“ CRUDã€æ¡ç›®ç®¡ç†ã€æ‰¹é‡å¯¼å…¥ã€æ™ºèƒ½æœç´¢ (RAG)
- **è”ç½‘æœç´¢**: å¯é€‰ Google CSE è”ç½‘æ£€ç´¢ï¼Œé€šè¿‡ Serverless æ¥å£è½¬å‘ä¸é‰´æƒ
- **ç”¨æˆ·è®¤è¯ç³»ç»Ÿ**: åŸºäº Supabase çš„å®Œæ•´ç”¨æˆ·ç®¡ç†å’Œæ•°æ®éš”ç¦»
- **æ•°æ®åŒæ­¥**: äº‘ç«¯å®æ—¶åŒæ­¥ã€ç¦»çº¿æ”¯æŒã€å¤šè®¾å¤‡æ— ç¼åˆ‡æ¢
- **å…¨å±€æç¤ºè¯**: å¯å¤ç”¨çš„æç¤ºè¯æ¨¡æ¿ï¼Œæ”¯æŒæ‹–æ‹½æ’åº
- **è¯­éŸ³åŠŸèƒ½**: é›†æˆ Fish Audio TTSï¼Œæ”¯æŒæ–‡æœ¬è½¬è¯­éŸ³å’ŒéŸ³é¢‘å¯è§†åŒ–
- **ä¼šè¯ç®¡ç†**: å®Œæ•´çš„èŠå¤©å†å²è®°å½•ã€ä¼šè¯æœç´¢å’Œåˆ†ç±»ç®¡ç†
- **å¤šäº‘å­˜å‚¨**: æ”¯æŒ AWS S3 / Aliyun OSS / Tencent COSï¼Œç”¨äºä¸Šä¼ ä¸ç®¡ç†æ–‡ä»¶èµ„æº
- **è·¨å¹³å°æ”¯æŒ**: å®Œç¾é€‚é…æ¡Œé¢ç«¯ã€ç§»åŠ¨ç«¯ Webï¼Œå¹¶æä¾› iOS åŸç”Ÿåº”ç”¨ä½“éªŒ

### ğŸ¨ ç”¨æˆ·ä½“éªŒ
- **ç°ä»£åŒ–ç•Œé¢**: åŸºäº DaisyUI 5.0 çš„ç²¾ç¾è®¾è®¡ç³»ç»Ÿ
- **å¤šä¸»é¢˜æ”¯æŒ**: æ”¯æŒäº®è‰²ã€æ·±è‰²ã€çº¸æ¯è›‹ç³•ã€æµ®å…‰ç­‰å¤šç§ä¸»é¢˜
- **è¾“å…¥ä½“éªŒä¼˜åŒ–**: é’ˆå¯¹ç§»åŠ¨ç«¯çš„è¾“å…¥æ¡†é˜²é®æŒ¡ã€é˜²è‡ªåŠ¨å¡«å……å¹²æ‰°ä¼˜åŒ–
- **æ™ºèƒ½é€šçŸ¥**: ä¼˜é›…çš„ Toast é€šçŸ¥ç³»ç»Ÿ
- **æ•°æ®æŒä¹…åŒ–**: æœ¬åœ°å­˜å‚¨ + äº‘ç«¯åŒæ­¥ï¼Œæ•°æ®å®‰å…¨å¯é 

### ğŸ”§ æŠ€æœ¯ç‰¹è‰²
- **TypeScript**: å®Œæ•´çš„ç±»å‹å®‰å…¨ä¿éšœ
- **ç»„ä»¶åŒ–æ¶æ„**: é«˜åº¦æ¨¡å—åŒ–å’Œå¯ç»´æŠ¤çš„ä»£ç ç»“æ„
- **ç§»åŠ¨ç«¯åŸç”Ÿ**: ä½¿ç”¨ Capacitor å°† Web åº”ç”¨æ‰“åŒ…ä¸º iOS åŸç”Ÿåº”ç”¨
- **çŠ¶æ€ç®¡ç†**: åŸºäº Zustand 5.0 çš„è½»é‡çº§çŠ¶æ€ç®¡ç†
- **å®æ—¶é€šä¿¡**: Server-Sent Events å®ç°æµå¼æ•°æ®ä¼ è¾“
- **æ•°æ®åº“é›†æˆ**: Supabase å®æ—¶æ•°æ®åº“ï¼Œæ”¯æŒ RLS æƒé™æ§åˆ¶
- **æ™ºèƒ½æœç´¢**: åŸºäº jieba-wasm çš„ä¸­æ–‡åˆ†è¯å’Œå…³é”®è¯åŒ¹é…
- **Markdown æ¸²æŸ“**: æ”¯æŒä»£ç é«˜äº®å’Œ GitHub é£æ ¼çš„ Markdown

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

- **å‰ç«¯æ¡†æ¶**: React 18.3 + TypeScript 5.8
- **ç§»åŠ¨ç«¯æ¡†æ¶**: Capacitor 7.4 (iOS)
- **æ„å»ºå·¥å…·**: Vite 6.3
- **æ ·å¼æ–¹æ¡ˆ**: Tailwind CSS 4.1 + DaisyUI 5.0
- **çŠ¶æ€ç®¡ç†**: Zustand 5.0
- **è·¯ç”±ç®¡ç†**: React Router DOM 7.3
- **åç«¯/æ•°æ®åº“**: Supabase (PostgreSQL + Auth + Realtime)
- **äº‘å­˜å‚¨**: AWS S3 å…¼å®¹åè®® (æ”¯æŒ AWS, Aliyun OSS, Tencent COS)
- **å·¥å…·åº“**: 
  - `jieba-wasm`: ä¸­æ–‡åˆ†è¯
  - `lucide-react`: å›¾æ ‡åº“
  - `react-markdown`: Markdown æ¸²æŸ“
  - `framer-motion` / `@react-spring/web`: åŠ¨ç”»

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚
- Node.js 22.x (æ¨è)
- pnpm æˆ– npm
- Xcode (ä»… iOS å¼€å‘éœ€è¦)
- Supabase é¡¹ç›® (ç”¨äºè®¤è¯ä¸æ•°æ®åŒæ­¥)
- Fish Audio API å¯†é’¥ (å¯é€‰ï¼Œç”¨äºè¯­éŸ³åŠŸèƒ½)

### å®‰è£…ä¾èµ–
```bash
# ä½¿ç”¨ pnpm (æ¨è)
pnpm install

# æˆ–ä½¿ç”¨ npm
npm install
```

### å¯åŠ¨ Web å¼€å‘æœåŠ¡å™¨
```bash
npm run dev
```
è®¿é—® [http://localhost:5173](http://localhost:5173) æŸ¥çœ‹åº”ç”¨ã€‚

### ç¯å¢ƒå˜é‡é…ç½®
æœ¬é¡¹ç›®åŒæ—¶åŒ…å«å‰ç«¯ä¸ Serverless æ¥å£èƒ½åŠ›ï¼Œå»ºè®®ä½¿ç”¨ `.env.local` ç®¡ç†æœ¬åœ°ç¯å¢ƒå˜é‡ï¼ˆä¸ä¼šæäº¤åˆ°ä»“åº“ï¼‰ã€‚

1. **åˆ›å»ºç¯å¢ƒå˜é‡æ–‡ä»¶**
   ```bash
   cp .env.example .env.local
   ```

2. **é…ç½® Supabaseï¼ˆå¿…å¡«ï¼‰**
   - `VITE_SUPABASE_URL`
   - `VITE_SUPABASE_ANON_KEY`

3. **é…ç½®è”ç½‘æœç´¢ / åç«¯æ¥å£é‰´æƒï¼ˆå¯é€‰ï¼‰**
   - `VITE_API_SECRET`ï¼šå‰ç«¯è¯·æ±‚æ—¶é€šè¿‡ `x-api-key` ä¼ ç»™åç«¯
   - `API_SECRET`ï¼šServerless æ ¡éªŒ `x-api-key`
   - `GOOGLE_SEARCH_API_KEY`ã€`GOOGLE_SEARCH_CX`ï¼šç”¨äº `/api/search`ï¼ˆæ¨èé…ç½®åœ¨æœåŠ¡ç«¯ï¼‰

4. **é…ç½®ç”Ÿäº§ç¯å¢ƒ API åŸºå€ï¼ˆéƒ¨ç½²æ—¶å¿…å¡«ï¼‰**
   - `VITE_API_BASE_URL`ï¼šæŒ‡å‘ä½ çš„éƒ¨ç½²åŸŸåï¼ˆä¾‹å¦‚ Vercelï¼‰

> æç¤ºï¼šæ›´å¤šé…ç½®ç¤ºä¾‹è§ [.env.example](./.env.example)ï¼›æœ¬åœ°ä»£ç†æœåŠ¡é…ç½®è§ [local-server/.env.example](./local-server/.env.example)ã€‚

### Serverless APIï¼ˆéƒ¨ç½²åˆ° Vercelï¼‰
é¡¹ç›®æ ¹ç›®å½•çš„ `api/` æä¾› Serverless Functionsï¼š
- `/api/tts`ï¼šTTS è½¬å‘ä¸æµå¼è¾“å‡º
- `/api/search`ï¼šGoogle CSE è”ç½‘æœç´¢
- `/api/health`ã€`/api/models`ã€`/api/model-info`ã€`/api/validate-key`ï¼šè¯Šæ–­ä¸è¾…åŠ©æ¥å£

### æœ¬åœ°è¿è¡Œä»£ç†æœåŠ¡ï¼ˆå¯é€‰ï¼‰
å¦‚æœä½ å¸Œæœ›åœ¨æœ¬åœ°è¿è¡Œä»£ç†æœåŠ¡ï¼ˆTTS / è”ç½‘æœç´¢ ç­‰ï¼‰ï¼Œå¯ä½¿ç”¨ `local-server/`ï¼š
```bash
cd local-server && npm run dev
```

### iOS å¼€å‘ä¸æ„å»º
æœ¬é¡¹ç›®æ”¯æŒé€šè¿‡ Capacitor æ„å»º iOS åº”ç”¨ã€‚

1. **æ„å»ºå‰ç«¯èµ„æº**
   ```bash
   npm run build
   ```

2. **åŒæ­¥èµ„æºåˆ° iOS é¡¹ç›®**
   ```bash
   npx cap sync
   # æˆ–è€…ä½¿ç”¨ npm è„šæœ¬
   npm run cap:sync
   ```

3. **æ‰“å¼€ Xcode è¿›è¡Œè°ƒè¯•/æ‰“åŒ…**
   ```bash
   npx cap open ios
   # æˆ–è€…ä½¿ç”¨ npm è„šæœ¬
   npm run cap:open:ios
   ```

---

<a name="english"></a>

# Floaty Bub ğŸ«§

A modern intelligent dialogue assistant based on React + TypeScript + Capacitor, integrating multi-role dialogue, knowledge base management, voice interaction, and data synchronization. Supports both Web and native iOS experiences.

> Developed with [TRAE SOLO](https://trae.ai)
>
> [View Web Demo](https://floatybub.vercel.app/)

## âœ¨ Features

### ğŸ¯ Core Features
- **Multi-Model Support**: Supports mainstream LLMs like Kimi, Moonshot, OpenAI, Claude, Gemini, etc.
- **Streaming Response**: Real-time AI response display with streaming text and image generation.
- **Smart Persona System**: Custom AI personas, system prompts, and personalized greetings.
- **Agent Skills**: Attach skill instructions and files to roles/sessions, enable per session with persistence.
- **Knowledge Base**: Full RAG support with CRUD, bulk import, and intelligent search.
- **Web Search**: Optional Google CSE search via authenticated Serverless API.
- **Authentication**: Complete user management and data isolation based on Supabase.
- **Data Sync**: Real-time cloud sync, offline support, and seamless multi-device switching.
- **Global Prompts**: Reusable prompt templates with drag-and-drop sorting.
- **Voice Interaction**: Integrated Fish Audio TTS for text-to-speech and audio visualization.
- **Chat Management**: Complete chat history, search, and categorization.
- **Multi-Cloud Storage**: AWS S3 / Aliyun OSS / Tencent COS adapters for file storage.
- **Cross-Platform**: Responsive design for Desktop/Web and native iOS support via Capacitor.

### ğŸ¨ User Experience
- **Modern UI**: Beautiful design system based on DaisyUI 5.0.
- **Theming**: Supports Light, Dark, Cupcake, Synthwave, and more.
- **Optimized Input**: Enhanced input handling for mobile (preventing autofill interference).
- **Smart Notifications**: Elegant Toast notification system.
- **Persistence**: Local storage + Cloud sync for data reliability.

### ğŸ”§ Technical Highlights
- **TypeScript**: Complete type safety.
- **Component Architecture**: Highly modular and maintainable code.
- **Native Mobile**: Capacitor for packaging Web app as native iOS app.
- **State Management**: Lightweight state management with Zustand 5.0.
- **Real-time Communication**: Server-Sent Events for streaming data.
- **Database**: Supabase Realtime database with RLS.
- **Smart Search**: Chinese word segmentation via jieba-wasm.
- **Markdown**: Code highlighting and GitHub-flavored Markdown support.

## ğŸ› ï¸ Tech Stack

- **Frontend**: React 18.3 + TypeScript 5.8
- **Mobile**: Capacitor 7.4 (iOS)
- **Build Tool**: Vite 6.3
- **Styling**: Tailwind CSS 4.1 + DaisyUI 5.0
- **State Management**: Zustand 5.0
- **Routing**: React Router DOM 7.3
- **Backend/DB**: Supabase (PostgreSQL + Auth + Realtime)
- **Storage**: AWS S3 Compatible (AWS, Aliyun OSS, Tencent COS)
- **Utilities**: 
  - `jieba-wasm`: Word segmentation
  - `lucide-react`: Icons
  - `react-markdown`: Rendering
  - `framer-motion` / `@react-spring/web`: Animations

## ğŸš€ Quick Start

### Prerequisites
- Node.js 22.x (Recommended)
- pnpm or npm
- Xcode (For iOS development only)
- Supabase Project (For auth and data sync)
- Fish Audio API Key (Optional, for voice features)

### Installation
```bash
# Using pnpm (Recommended)
pnpm install

# Or using npm
npm install
```

### Start Web Development Server
```bash
npm run dev
```
Visit [http://localhost:5173](http://localhost:5173).

### Environment Variables
Use `.env.local` for local development (not committed).

1. **Create `.env.local`**
   ```bash
   cp .env.example .env.local
   ```

2. **Supabase (Required)**
   - `VITE_SUPABASE_URL`
   - `VITE_SUPABASE_ANON_KEY`

3. **Search / API Auth (Optional)**
   - `VITE_API_SECRET` (sent as `x-api-key`)
   - `API_SECRET` (validated by Serverless functions)
   - `GOOGLE_SEARCH_API_KEY`, `GOOGLE_SEARCH_CX` for `/api/search` (recommended on server)

4. **API Base URL for Production (Required when deployed)**
   - `VITE_API_BASE_URL` (your deployed domain, e.g. Vercel)

> See [.env.example](./.env.example) and [local-server/.env.example](./local-server/.env.example) for examples.

### Serverless API (Vercel)
Serverless functions in `api/`:
- `/api/tts` (TTS proxy with streaming output)
- `/api/search` (Google CSE web search)
- `/api/health`, `/api/models`, `/api/model-info`, `/api/validate-key` (diagnostics)

### Run Local Proxy Server (Optional)
To run the local proxy server (TTS / web search, etc.) without relying on a deployed backend:
```bash
cd local-server && npm run dev
```

### iOS Development & Build
This project supports building for iOS via Capacitor.

1. **Build Frontend Assets**
   ```bash
   npm run build
   ```

2. **Sync Assets to iOS Project**
   ```bash
   npx cap sync
   # Or use the script
   npm run cap:sync
   ```

3. **Open Xcode**
   ```bash
   npx cap open ios
   # Or use the script
   npm run cap:open:ios
   ```
